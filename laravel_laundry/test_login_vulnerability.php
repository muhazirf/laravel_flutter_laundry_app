<?php

/**
 * Demo untuk membuktikan login vulnerability yang sudah diperbaiki
 * File ini hanya untuk demonstrasi - JANGAN gunakan di production!
 */

echo "=== LOGIN VULNERABILITY TEST DEMO ===\n\n";

// Simulasi test data
$testCases = [
    [
        'email' => 'admin@example.com',
        'password' => '',
        'description' => 'Empty password (should fail)'
    ],
    [
        'email' => 'admin@example.com',
        'password' => 'wrong_password',
        'description' => 'Wrong password (should fail)'
    ],
    [
        'email' => 'admin@example.com',
        'password' => 'correct_password',
        'description' => 'Correct credentials (should succeed)'
    ]
];

foreach ($testCases as $index => $test) {
    echo "TEST #" . ($index + 1) . ": {$test['description']}\n";
    echo "Email: {$test['email']}\n";
    echo "Password: " . ($test['password'] ?: '[EMPTY]') . "\n";
    echo "----------------------------------------\n";

    // Buat cURL request
    $ch = curl_init();
    curl_setopt($ch, CURLOPT_URL, 'http://localhost:8181/api/auth/login');
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_POST, true);
    curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode([
        'email' => $test['email'],
        'password' => $test['password']
    ]));
    curl_setopt($ch, CURLOPT_HTTPHEADER, [
        'Content-Type: application/json',
        'Accept: application/json'
    ]);

    $response = curl_exec($ch);
    $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);
    curl_close($ch);

    echo "HTTP Status: {$httpCode}\n";
    echo "Response: {$response}\n";
    echo "\n" . str_repeat("=", 50) . "\n\n";
}

echo "=== ANALYSIS ===\n";
echo "✅ FIXED: Semua invalid credentials harus return 401 Unauthorized\n";
echo "✅ FIXED: Hanya valid credentials yang return 200 dengan JWT token\n";
echo "✅ FIXED: Response format konsisten dengan success/data/errors fields\n";
echo "✅ FIXED: Tidak ada lagi login tanpa password!\n";

?>